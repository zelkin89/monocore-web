---
import LogLayout from '../../layouts/LogLayout.astro';
import { getCollection } from 'astro:content';
import { openModal } from '../../store/modalStore';

// Ottieni tutti i log ordinati per data
const logs = (await getCollection('logs')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const formatDate = (date: Date) => {
    return new Date(date).toLocaleDateString('it-IT', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
    });
};
---

<LogLayout title="Archive" description="Archivio ufficiale dei protocolli e case study Monocore OS.">
    <div class="max-w-4xl mx-auto px-6">
        
        <!-- Header -->
        <div class="mb-16 border-b border-white/10 pb-8 flex justify-between items-end">
            <div>
                <p class="font-mono text-xs text-brand-orange uppercase tracking-widest mb-2">
                    // DATABASE ACCESS
                </p>
                <h1 class="font-sans font-bold text-4xl md:text-5xl text-white uppercase tracking-tighter">
                    SYSTEM LOGS ARCHIVE
                </h1>
            </div>
            <div class="hidden md:block font-mono text-xs text-industrial/40 text-right">
                TOTAL ENTRIES: {logs.length.toString().padStart(2, '0')}<br/>
                STATUS: ONLINE
            </div>
        </div>

        <!-- Logs List (Table Style) -->
        <div class="flex flex-col gap-1">
            
            {logs.map((post) => (
                <a 
                    href={`/logs/${post.slug}`}
                    class="group flex flex-col md:flex-row md:items-center gap-4 md:gap-8 p-4 border border-transparent hover:bg-white/5 hover:border-white/5 transition-all duration-300 rounded-sm"
                >
                    {/* Date */}
                    <div class="font-mono text-xs text-industrial/40 w-24 flex-shrink-0">
                        {formatDate(post.data.pubDate)}
                    </div>

                    {/* Category Badge */}
                    <div class="flex-shrink-0">
                        <span class="inline-block px-2 py-1 border border-white/20 rounded-sm font-mono text-[10px] text-industrial/60 uppercase tracking-wide group-hover:border-brand-orange/50 group-hover:text-brand-orange transition-colors">
                            {post.data.category}
                        </span>
                    </div>

                    {/* Title */}
                    <div class="flex-grow">
                        <h3 class="font-sans font-bold text-lg text-white group-hover:text-brand-orange transition-colors uppercase tracking-tight">
                            {post.data.title}
                        </h3>
                    </div>

                    {/* Read Arrow */}
                    <div class="hidden md:block text-brand-orange opacity-0 -translate-x-4 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300">
                        READ_LOG -&gt;
                    </div>
                </a>
            ))}

            {logs.length === 0 && (
                <div class="py-12 text-center font-mono text-industrial/40">
                    NO LOGS FOUND IN DATABASE.
                </div>
            )}

        </div>

    </div>
</LogLayout>

<!-- Sticky Script per gestire la UI se necessario -->
<script>
    console.log('Monocore Logs Archive Initialized');
</script>
